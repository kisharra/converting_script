# üìÅ –ü—Ä–æ–µ–∫—Ç: –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤–∏–¥–µ–æ

## üìë –û–≥–ª–∞–≤–ª–µ–Ω–∏–µ

* [db\_handler.py](#db_handlerpy)
* [single\_handler.py](#single_handlerpy)
* [dir\_handler.py](#dir_handlerpy)
* [main\_handler.py](#main_handlerpy)


---

## üìÑ `db_handler.py`

–§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç –∫–ª–∞—Å—Å `Db_query`, –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã–π –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å SQLite –∏ MariaDB –±–∞–∑–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö. –û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç —Å–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü, –≤—Å—Ç–∞–≤–∫—É –∏ –≤—ã–±–æ—Ä–∫—É –¥–∞–Ω–Ω—ã—Ö, –∞ —Ç–∞–∫–∂–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –∑–∞–¥–∞—á –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏.

### `class Db_query`

**–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è:**

```python
Db_query(config: dict)
```

* **config**: —Å–ª–æ–≤–∞—Ä—å —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ –ø—É—Ç–µ–π –∫ SQLite –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è MariaDB.
* –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç:

  * –ø—É—Ç—å –∫ SQLite-—Ñ–∞–π–ª—É –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
  * –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ MariaDB

---

### `def table_exists(self, table_name)`

* **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**: `table_name` (str) ‚Äî –∏–º—è —Ç–∞–±–ª–∏—Ü—ã
* **–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç**: `bool` ‚Äî —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ —Ç–∞–±–ª–∏—Ü–∞ –≤ SQLite

### `def create_table(self)`

* **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**: –Ω–µ—Ç
* **–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç**: None
* –°–æ–∑–¥–∞—ë—Ç —Ç–∞–±–ª–∏—Ü—ã `Files` –∏ `ConversionTasks`, –µ—Å–ª–∏ –æ–Ω–∏ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É—é—Ç

### `def save_file_data(self, data, streams, is_film, is_serial)`

* **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**:

  * `data`: dict ‚Äî –¥–∞–Ω–Ω—ã–µ –æ –≤–∏–¥–µ–æ
  * `streams`: list ‚Äî —Å–ø–∏—Å–æ–∫ –ø–æ—Ç–æ–∫–æ–≤
  * `is_film`, `is_serial`: bool ‚Äî —Ñ–ª–∞–≥–∏ —Ç–∏–ø–∞ –≤–∏–¥–µ–æ
* **–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç**: None
* –î–æ–±–∞–≤–ª—è–µ—Ç –∑–∞–ø–∏—Å—å –≤ —Ç–∞–±–ª–∏—Ü—É `Files`, –µ—Å–ª–∏ —Ç–∞–∫–æ–π –µ—â—ë –Ω–µ—Ç

### `def save_data_if_comment(self, data, streams, is_film, is_serial)`

* **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**:

  * `data`: dict
  * `streams`: list
  * `is_film`, `is_serial`: bool
* **–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç**: None
* –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ `save_file_data`, –Ω–æ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç `IsConverted=True`

### `def interrupted_program(self, current_time, file_id)`

* **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**:

  * `current_time`: datetime
  * `file_id`: int
* **–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç**: None
* –û–±–Ω–æ–≤–ª—è–µ—Ç —Å—Ç–∞—Ç—É—Å –∑–∞–¥–∞—á–∏ –∫–∞–∫ "–ø—Ä–µ—Ä–≤–∞–Ω–Ω–∞—è" —Å —É—Å—Ç–∞–Ω–æ–≤–∫–æ–π –≤—Ä–µ–º–µ–Ω–∏ –æ–∫–æ–Ω—á–∞–Ω–∏—è

### `def select_data(self)`

* **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**: –Ω–µ—Ç
* **–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç**: list ‚Äî –≤—Å–µ –∑–∞–ø–∏—Å–∏ –∏–∑ —Ç–∞–±–ª–∏—Ü—ã `Files`

### `def select_single_data(self, filename)`

* **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**: `filename` (str)
* **–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç**: list ‚Äî –∑–∞–ø–∏—Å—å –∏–∑ —Ç–∞–±–ª–∏—Ü—ã `Files` –ø–æ –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–∞

### `def select_directory_data(self, directory)`

* **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**: `directory` (str)
* **–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç**: list ‚Äî –∑–∞–ø–∏—Å–∏ `Files`, —á—å–∏ –∏–º–µ–Ω–∞ –Ω–∞—á–∏–Ω–∞—é—Ç—Å—è —Å —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ –ø—É—Ç–∏

### `def update_status_of_conversion(self, file_id, status, current_time)`

* **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**:

  * `file_id`: int
  * `status`: str
  * `current_time`: datetime
* **–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç**: None
* –í—Å—Ç–∞–≤–ª—è–µ—Ç –Ω–æ–≤—É—é –∑–∞–¥–∞—á—É –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ –≤ `ConversionTasks`

### `def update_status_first_check(self, file_id, status, start_time, end_time)`

* **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**:

  * `file_id`: int
  * `status`: str
  * `start_time`, `end_time`: datetime
* **–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç**: None
* –í—Å—Ç–∞–≤–ª—è–µ—Ç –∑–∞–¥–∞—á—É —Å –Ω–∞—á–∞–ª–æ–º –∏ –∫–æ–Ω—Ü–æ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

### `def update_isconverted_after_fail_check(self, file_id, is_converted)`

* **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**:

  * `file_id`: int
  * `is_converted`: bool
* **–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç**: None
* –û–±–Ω–æ–≤–ª—è–µ—Ç —Ñ–ª–∞–≥ `IsConverted` –≤ `Files`

### `def update_status_ending_conversion(self, status, current_time, check_result, file_id)`

* **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**:

  * `status`: str
  * `current_time`: datetime
  * `check_result`: str
  * `file_id`: int
* **–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç**: None
* –û–±–Ω–æ–≤–ª—è–µ—Ç —Å—Ç–∞—Ç—É—Å, –≤—Ä–µ–º—è –æ–∫–æ–Ω—á–∞–Ω–∏—è –∏ –ø—Ä–æ–≤–µ—Ä–∫—É —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏

### `def update_files_table(self, output_file, is_conveted, nb_streams, size, bitrate, streams, file_id)`

* **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**:

  * `output_file`: str
  * `is_conveted`: bool
  * `nb_streams`: int
  * `size`: int
  * `bitrate`: int
  * `streams`: str (JSON)
  * `file_id`: int
* **–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç**: None
* –û–±–Ω–æ–≤–ª—è–µ—Ç –∑–∞–ø–∏—Å—å `Files` –Ω–æ–≤—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ –≤–∏–¥–µ–æ

### `def update_of_checking_integrity(self, status, current_time, check_result, file_id)`

* **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**:

  * `status`: str
  * `current_time`: datetime
  * `check_result`: str
  * `file_id`: int
* **–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç**: None
* –¢–æ –∂–µ, —á—Ç–æ `update_status_ending_conversion` ‚Äî –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ

### `def update_url_file(self, filename, output_file)`

* **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**:

  * `filename`: str
  * `output_file`: str
* **–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç**: None
* –û–±–Ω–æ–≤–ª—è–µ—Ç URL –≤ —Ç–∞–±–ª–∏—Ü–µ `video_series_files` MariaDB

### `def global_interrupted_query(self, current_time)`

* **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**: `current_time` (datetime)
* **–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç**: list ‚Äî –∑–∞–ø–∏—Å–∏ —Å –∑–∞–¥–∞—á–∞–º–∏, –∫–æ—Ç–æ—Ä—ã–µ –±—ã–ª–∏ –≤ —Å—Ç–∞—Ç—É—Å–µ `converting`
* –ú–∞—Å—Å–æ–≤–æ –æ–±–Ω–æ–≤–ª—è–µ—Ç –∑–∞–¥–∞—á–∏ —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º `converting` –Ω–∞ `interrupted`

---

## üìÑ `single_handler.py`

–§–∞–π–ª —Ä–µ–∞–ª–∏–∑—É–µ—Ç –∫–ª–∞—Å—Å `ConvertTask`, –∫–æ—Ç–æ—Ä—ã–π –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—é –≤–∏–¥–µ–æ—Ñ–∞–π–ª–æ–≤, –ø—Ä–æ–≤–µ—Ä–∫—É —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏—Ö –∑–∞–ø–∏—Å–µ–π –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö.

### `class ConvertTask`

**–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è:**

```python
ConvertTask(config: dict)
```

* **config**: —Å–ª–æ–≤–∞—Ä—å —Å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π –ø—Ä–æ–µ–∫—Ç–∞
* –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç:

  * –ø—É—Ç–∏ –∫ –≤—Ä–µ–º–µ–Ω–Ω—ã–º –∏ —Ä–∞–±–æ—á–∏–º —Ñ–∞–π–ª–∞–º
  * –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
  * –ø–∞—Ä–∞–º–µ—Ç—Ä—ã ffmpeg
  * –æ–±—ä–µ–∫—Ç `Get_Info`

---

### `def signal_handler(self, signum, frame)`

* **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**:

  * `signum`: int ‚Äî —Å–∏–≥–Ω–∞–ª
  * `frame`: frame ‚Äî —Ç–µ–∫—É—â–∏–π —Å—Ç–µ–∫ –≤—ã–∑–æ–≤–æ–≤
* **–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç**: None
* –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Ñ–ª–∞–≥ `self.interrupted = True`

### `def set_pdeathsig(self)`

* **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**: –Ω–µ—Ç
* **–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç**: None
* –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Å–∏–≥–Ω–∞–ª —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–≥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ø—Ä–æ—Ü–µ—Å—Å–∞ (PR\_SET\_PDEATHSIG)

### `def create_pid_file(self)`

* **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**: –Ω–µ—Ç
* **–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç**: str ‚Äî –ø—É—Ç—å –∫ PID-—Ñ–∞–π–ª—É
* –°–æ–∑–¥–∞—ë—Ç –ø—É—Å—Ç–æ–π PID-—Ñ–∞–π–ª, –µ—Å–ª–∏ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç

### `def clear_pid_file(self, file_path)`

* **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**: `file_path` (str)
* **–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç**: None
* –û—á–∏—â–∞–µ—Ç —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ PID-—Ñ–∞–π–ª–∞

### `def check_integrity(self, output_file)`

* **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**: `output_file` (str)
* **–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç**: tuple\[bool, str] ‚Äî —Å—Ç–∞—Ç—É—Å –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏
* –ó–∞–ø—É—Å–∫–∞–µ—Ç ffmpeg-–ø—Ä–æ–≤–µ—Ä–∫—É –Ω–∞ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å —Ñ–∞–π–ª–∞

### `def run_ffmpeg(self, input_file, output_file, bitrate, audio_stream_index)`

* **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**:

  * `input_file`: str
  * `output_file`: str
  * `bitrate`: str
  * `audio_stream_index`: int
* **–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç**: tuple\[bool, str] ‚Äî —Å—Ç–∞—Ç—É—Å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç
* –í—ã–ø–æ–ª–Ω—è–µ—Ç –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—é –≤–∏–¥–µ–æ —á–µ—Ä–µ–∑ ffmpeg

### `def get_data(self, file_data)`

* **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**: `file_data` (str) ‚Äî –∏–º—è —Ñ–∞–π–ª–∞
* **–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç**: list ‚Äî —Å–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤, –ø–æ–¥–ª–µ–∂–∞—â–∏—Ö –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏, —Å –∏–Ω–¥–µ–∫—Å–∞–º–∏ –∞—É–¥–∏–æ–¥–æ—Ä–æ–∂–µ–∫

### `def convert_files(self, file_data)`

* **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**: `file_data` (str) ‚Äî –∏–º—è –≤–∏–¥–µ–æ—Ñ–∞–π–ª–∞
* **–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç**: None
* –û—Å–Ω–æ–≤–Ω–æ–π –º–µ—Ç–æ–¥ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏:

  * –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ –∏—Å—Ö–æ–¥–Ω–æ–≥–æ —Ñ–∞–π–ª–∞
  * –ó–∞–ø—É—Å–∫ ffmpeg
  * –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—ã—Ö–æ–¥–Ω–æ–≥–æ —Ñ–∞–π–ª–∞
  * –ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ, –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ, —É–¥–∞–ª–µ–Ω–∏–µ –æ—Ä–∏–≥–∏–Ω–∞–ª–∞
  * –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü Files –∏ Ministra

---

## üìÑ `dir_handler.py`

–§–∞–π–ª `dir_handler.py` —Ä–µ–∞–ª–∏–∑—É–µ—Ç —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—É—é –≤–µ—Ä—Å–∏—é `ConvertTask` —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –º–Ω–æ–≥–æ–ø—Ä–æ—Ü–µ—Å—Å–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ñ–∞–π–ª–æ–≤ –∏ —Ñ—É–Ω–∫—Ü–∏–µ–π –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–π –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ –≤–∏–¥–µ–æ –≤ –∑–∞–¥–∞–Ω–Ω–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏.

### `class ConvertTask`

**–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è:**

```python
ConvertTask(config: dict)
```

* **config**: —Å–ª–æ–≤–∞—Ä—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
* –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç:

  * –ø—É—Ç–∏ –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ ffmpeg
  * –æ–±—ä–µ–∫—Ç –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö `Db_query`
  * –æ–±—ä–µ–∫—Ç `Get_Info`
  * –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω—ã–π –∑–∞–º–æ–∫ `pid_lock`

### `def signal_handler(self, signum, frame)`

* **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**:

  * `signum`: int
  * `frame`: frame
* **–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç**: None
* –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–µ –ø–æ —Å–∏–≥–Ω–∞–ª—É SIGINT

### `def set_pdeathsig(self)`

* **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**: –Ω–µ—Ç
* **–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç**: None
* –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–π —Å–∏–≥–Ω–∞–ª –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ø—Ä–æ—Ü–µ—Å—Å–∞ (PR\_SET\_PDEATHSIG)

### `def create_pid_file(self)`

* **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**: –Ω–µ—Ç
* **–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç**: str ‚Äî –ø—É—Ç—å –∫ PID-—Ñ–∞–π–ª—É
* –°–æ–∑–¥–∞—ë—Ç –ø—É—Å—Ç–æ–π PID-—Ñ–∞–π–ª

### `def clear_pid_file(self, file_path)`

* **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**: `file_path` (str)
* **–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç**: None
* –û—á–∏—â–∞–µ—Ç PID-—Ñ–∞–π–ª

### `def check_integrity(self, output_file)`

* **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**: `output_file` (str)
* **–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç**: tuple\[bool, str] ‚Äî —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏
* –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ –≤–∏–¥–µ–æ —á–µ—Ä–µ–∑ ffmpeg

### `def run_ffmpeg(self, input_file, output_file, bitrate, audio_stream_index)`

* **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**:

  * `input_file`: str
  * `output_file`: str
  * `bitrate`: str
  * `audio_stream_index`: int
* **–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç**: tuple\[bool, str] ‚Äî —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏
* –ó–∞–ø—É—Å–∫–∞–µ—Ç ffmpeg-–ø—Ä–æ—Ü–µ—Å—Å —Å –∑–∞–¥–∞–Ω–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏

### `def get_data(self, file_data)`

* **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**: `file_data` (str) ‚Äî –ø—É—Ç—å –∫ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
* **–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç**: list ‚Äî —Å–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤ —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏

### `def convert_files(self, file_id, IsFilm, filename, selected_index)`

* **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**:

  * `file_id`: int
  * `IsFilm`: bool
  * `filename`: str
  * `selected_index`: int
* **–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç**: None
* –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç –æ–¥–∏–Ω —Ñ–∞–π–ª, –ø—Ä–æ–≤–æ–¥–∏—Ç –ø—Ä–æ–≤–µ—Ä–∫—É –¥–æ/–ø–æ—Å–ª–µ, –æ–±–Ω–æ–≤–ª—è–µ—Ç –ë–î –∏ —É–¥–∞–ª—è–µ—Ç –∏—Å—Ö–æ–¥–Ω–∏–∫

### `def parallel_convert(self, directory)`

* **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**: `directory` (str)
* **–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç**: None
* –†–∞–∑–±–∏–≤–∞–µ—Ç —Å–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤ –Ω–∞ –≥—Ä—É–ø–ø—ã –ø–æ 2 –∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∏—Ö –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ —Å –ø–æ–º–æ—â—å—é `multiprocessing.Pool`
* –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—è, —á–∏—Å—Ç–∏—Ç –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏, –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å—Ç–∞—Ç—É—Å—ã –∑–∞–¥–∞—á

---

## üìÑ `server_handler.py`

–§–∞–π–ª `server_handler.py` —Ä–µ–∞–ª–∏–∑—É–µ—Ç –∫–ª–∞—Å—Å `ConvertTask` –¥–ª—è —Å–µ—Ä–≤–µ—Ä–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤–∏–¥–µ–æ—Ñ–∞–π–ª–æ–≤. –û—Ç–ª–∏—á–∞–µ—Ç—Å—è –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –≤–Ω–µ—à–Ω–µ–≥–æ —Ñ–ª–∞–≥–∞ `stop_event`, –ø–æ–∑–≤–æ–ª—è—é—â–µ–≥–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ –ø—Ä–µ—Ä–≤–∞—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ.

### `class ConvertTask`

**–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è:**

```python
ConvertTask(config: dict, stop_event: threading.Event)
```

* **config**: dict ‚Äî –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
* **stop\_event**: threading.Event ‚Äî —Ñ–ª–∞–≥ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—è –ø—Ä–æ—Ü–µ—Å—Å–∞ –∏–∑–≤–Ω–µ

### `def create_pid_file(self)`

* **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**: –Ω–µ—Ç
* **–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç**: str ‚Äî –ø—É—Ç—å –∫ —Å–æ–∑–¥–∞–Ω–Ω–æ–º—É PID-—Ñ–∞–π–ª—É
* –°–æ–∑–¥–∞—ë—Ç –ø—É—Å—Ç–æ–π PID-—Ñ–∞–π–ª, –µ—Å–ª–∏ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç

### `def clear_pid_file(self, file_path)`

* **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**: `file_path`: str
* **–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç**: None
* –û—á–∏—â–∞–µ—Ç —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞ PID

### `def check_integrity(self, output_file)`

* **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**: `output_file`: str
* **–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç**: tuple(bool, str)
* –í—ã–ø–æ–ª–Ω—è–µ—Ç ffmpeg-–ø—Ä–æ–≤–µ—Ä–∫—É —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏, –ª–æ–≥–∏—Ä—É–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç, —É–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è `stop_event`

### `def run_ffmpeg(self, input_file, output_file, bitrate, audio_stream_index)`

* **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**:

  * `input_file`: str
  * `output_file`: str
  * `bitrate`: str
  * `audio_stream_index`: int
* **–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç**: tuple(bool, str)
* –í—ã–ø–æ–ª–Ω—è–µ—Ç ffmpeg-–∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—é —Ñ–∞–π–ª–∞, —É–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ `stop_event`

### `def get_data(self, file_data)`

* **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**: `file_data`: str ‚Äî –ø—É—Ç—å –∫ —Ñ–∞–π–ª—É
* **–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç**: list\[list] ‚Äî –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ, —Ñ–ª–∞–≥ —Ñ–∏–ª—å–º–∞, –∏–º—è, –∏–Ω–¥–µ–∫—Å –∞—É–¥–∏–æ
* –ü–æ–ª—É—á–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –ø–æ–¥—Ö–æ–¥—è—â–∏—Ö —Ñ–∞–π–ª–æ–≤ –∏–∑ –±–∞–∑—ã –∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –ø–æ–¥—Ö–æ–¥—è—â—É—é –∞—É–¥–∏–æ–¥–æ—Ä–æ–∂–∫—É

### `def convert_files(self, file_data)`

* **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**: `file_data`: str ‚Äî –∏–º—è —Ñ–∞–π–ª–∞
* **–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç**: None
* –ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ñ–∞–π–ª–∞:

  * –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–∏–µ –¥–æ
  * –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è —á–µ—Ä–µ–∑ ffmpeg
  * –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
  * –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü `Files`, `ConversionTasks` –∏ `Ministra`
  * –û—á–∏—Å—Ç–∫–∞ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ –¥–∞–∂–µ –≤ —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏
  * –†–µ–∞–≥–∏—Ä—É–µ—Ç –Ω–∞ `stop_event` –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –≤—ã—Ö–æ–¥–∞

---


